{% extends 'capsule/base.html' %}

{% block title %}Create Outfit{% endblock %}

{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<h1>Create Outfit</h1>
<h2>Canvas</h2>
<div id="canvas" class="canvas" style="width: 100%; height: 600px; border: 1px solid #ccc; background-color: #f9f9f9; position: relative; overflow: auto;">
    <p>Drag items here to create your outfit</p>
</div>
<div class="background-selector">
    <img src="{% static 'images/beach.jpg' %}" alt="Beach" class="background-option" data-background-url="{% static 'images/beach.jpg' %}">
    <img src="{% static 'images/park.jpg' %}" alt="Park" class="background-option" data-background-url="{% static 'images/park.jpg' %}">
    <img src="{% static 'images/winter.jpg' %}" alt="Winter" class="background-option" data-background-url="{% static 'images/winter.jpg' %}">
    <!-- Add more background images as needed -->
    <div class="color-option" data-background-color="#ffcccb" style="background-color: #ffcccb;"></div>
    <div class="color-option" data-background-color="#add8e6" style="background-color: #add8e6;"></div>
    <div class="color-option" data-background-color="#90ee90" style="background-color: #90ee90;"></div>
    <div class="color-option" data-background-color="#ffffff" style="background-color: #ffffff;"></div>
    <!-- Add more colors as needed -->
</div>
<form method="post" id="outfitForm">
    {% csrf_token %}
    {{ form|crispy }}
    <button type="submit" class="btn btn-primary">Save Outfit</button>
</form>
<hr>
<h2>Items</h2>
<div class="items-container">
    {% for item in items %}
        <div class="item" id="item-{{ item.id }}" data-id="{{ item.id }}">
            <img src="{{ item.image.url }}" alt="{{ item.name }}" width="100">
            <p>{{ item.name }}</p>
        </div>
    {% endfor %}
</div>
<hr>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

<script>
    $(function() {
        var maxZIndex = 1;
    
        $(".item").draggable({
            helper: "clone",
            appendTo: 'body',
            zIndex: 10000
        });
    
        $("#canvas").droppable({
            accept: ".item",
            drop: function(event, ui) {
                var itemId = ui.helper.data("id");
    
                // Check if the item is already in the canvas
                if ($("#canvas .item[data-id='" + itemId + "']").length === 0) {
                    var clone = ui.helper.clone();
                    clone.removeAttr("style");
                    clone.css({
                        width: '200px',  // Set image width to 100px
                        height: 'auto',  // Set image height to auto
                        position: 'absolute',
                        zIndex: maxZIndex++
                    });
                    clone.find("img").css({
                        width: '200px',  // Set image width to 100px
                        height: 'auto'   // Set image height to auto
                    });
                    clone.find("p").hide(); // Hide the item name
                    clone.appendTo("#canvas").draggable({
                        containment: "#canvas"
                    }).attr("data-id", itemId);
                    addClickHandler(clone);
                }
            }
        });
    
        function addClickHandler(element) {
            element.on('click', function() {
                $(this).css('z-index', maxZIndex++);
            });
        }
    
        // Attach click handlers to any existing items in the canvas
        $("#canvas .item").each(function() {
            addClickHandler($(this));
        });

        // Background selection
        $(".background-option").on('click', function() {
            var backgroundUrl = $(this).data("background-url");
            $("#canvas").css("background-image", "url(" + backgroundUrl + ")");
        });

        // Background color selection
        $(".color-option").on('click', function() {
            var backgroundColor = $(this).data("background-color");
            $("#canvas").css("background-color", backgroundColor);
            $("#canvas").css("background-image", "");  // Reset background image
        });
    
        $("#outfitForm").submit(function(e) {
            var selectedItems = [];
            $("#canvas .item").each(function() {
                selectedItems.push($(this).data("id"));
            });
    
            $('<input>').attr({
                type: 'hidden',
                name: 'items',
                value: JSON.stringify(selectedItems)
            }).appendTo("#outfitForm");
    
            return true;
        });
    });
</script>
<style>
    #canvas {
        width: 100%;
        height: 600px;
        border: 1px solid #ccc;
        background-color: #f9f9f9;
        position: relative;
        overflow: auto;
        background-size: cover;  /* Ensure the background image covers the entire canvas */
        background-position: center;  /* Center the background image */
    }

    .background-selector img {
        width: 100px;  /* Set the width for the background option thumbnails */
        height: auto;  /* Maintain the aspect ratio */
        margin: 10px;  /* Add some spacing around the images */
        cursor: pointer;  /* Change the cursor to pointer to indicate it's clickable */
    }

    .background-selector img:hover {
        opacity: 0.8;  /* Slightly dim the image on hover for a visual effect */
    }

    .color-option {
        width: 100px;  /* Set the width for the color option */
        height: 60px;  /* Set the height for the color option */
        display: inline-block;  /* Display as inline block */
        margin: 10px;  /* Add some spacing around the color options */
        cursor: pointer;  /* Change the cursor to pointer to indicate it's clickable */
    }

    .color-option:hover {
        opacity: 0.8;  /* Slightly dim the color option on hover for a visual effect */
    }
</style>
{% endblock %}
